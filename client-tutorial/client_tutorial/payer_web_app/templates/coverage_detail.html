{% extends "dark_layout.html" %}

{% block content %}
<!--
  ~ Copyright (c) 2021 IBM Corporation
  ~ Henry Feldman, MD (CMO Development, IBM Watson Health)
  -->

<div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Home</a></li>
            <li class="breadcrumb-item">
                <a href="requests?payerselect=xxx">Payer</a>
            </li>
            <li class="breadcrumb-item active"> <a href="/requests?payerselect={{payer.Name}}">Coverage</a></li>
            <li class="breadcrumb-item active">Details</li>
            <!-- Breadcrumb Menu-->
        </ol>
    </nav>
    <div class="row">
        <h1 class="display-2">Coverage Details for patient:</h1>
        <h1  class="display-3">Selected Payer: {{ payer['Name'] }}</h1>
        <table class="table table-borderless">
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                   <th>Request Match</th>
               </tr>
            <tr>
                <td><strong>Patient:</strong></td>
                    <th>{{ patient.last_name }}, {{patient.first_name }}</th>
                    <td>&nbsp;</td>
                   <td>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square-fill" viewBox="0 0 16 16">
                        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"/>
                        </svg></td>
            </tr>
            <tr>
                <td><strong>Requestor</strong></td>
                <td>{{ eligibilityRequest.requestor_name }} (mrn: {{ patient.SUBJECT_ID }})</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td><strong>Request Date</strong></td>
                <td>{{ requestDate }}</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td><strong>Service Type</strong></td>
                <td>{{ eligibilityRequest.request_service_type }}</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td><strong>Plan ID:</strong></td>
                <td>{{ coverage['payer_plan_id'] }}</td>
                    <td>&nbsp;</td>
                <td>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square-fill" viewBox="0 0 16 16">
                        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"/>
                    </svg></td>            </tr>
            <tr>
                <td><strong>Member ID:</strong></td>
                <td>{{ coverage['member_id'] }}</td>
                <td>&nbsp;</td>
                <td>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square-fill" viewBox="0 0 16 16">
                        <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"/>
                    </svg></td>
            </tr>
                {% for coverageOption in coverage['coveragePlanData'] %}
                    <tr>
                        <td><strong>{{ coverageOption['type'] }}</strong></td>
                        <td>{{ coverageOption['value'] }}</td>
                            {% if coverageOption['name'] %}
                                <td> {{ coverageOption['name'] }} </td>
                                {% if coverageOption['id'] in benefitMatchIds %}
                                    <td>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square-fill" viewBox="0 0 16 16">
                                            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"/>
                            </svg>
                            </td>
                                {% else %}
                                    <td><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                    </svg></td>
                                {% endif %}
                            {% endif %}
                    </tr>
                {% endfor %}
            <tr>
                <td><strong>Purpose:</strong></td>
                {% if eligibilityRequest.request_purpose == 'auth-requirements'%}
                    <td>{{ eligibilityRequest.request_purpose }} <span class="badge bg-warning text-dark">Prior Auth</span></td>
                {% else %}
                   <td>{{ eligibilityRequest.request_purpose }}</td>
                {% endif%}
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <tr>
                <td><strong>For Service:</strong></td>
                <td>{{ eligibilityRequest.request_service_type }}</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
        </table>

            {% if eligibilityRequest.coverage_option_1 or eligibilityRequest.coverage_option_2 or eligibilityRequest.coverage_option_3 %}
                <h4>Additional Benefit Searches</h4>
            <ul class="list-group list-group-flush">
                {% if eligibilityRequest.coverage_option_1 and benefit_1 != None %}
                    <li class="list-group-item list-group-item-secondary">{{ eligibilityRequest.coverage_option_1 }}</li>
                {% elif benefit_1 != None  %}
                    <li class="list-group-item  list-group-item-success">{{ eligibilityRequest.coverage_option_1 }} <i class="bi bi-person-check-fill"></i></li>
                {%endif %}
                {% if eligibilityRequest.coverage_option_2 and benefit_2 != None %}
                    <li class="list-group-item list-group-item-secondary">{{ eligibilityRequest.coverage_option_2 }}</li>
                {% elif benefit_2 != None %}
                    <li class="list-group-item  list-group-item-success">{{ eligibilityRequest.coverage_option_2 }} <i class="bi bi-person-check-fill"></i></li>
                {%endif %}
                {% if eligibilityRequest.coverage_option_3 and benefit_3 != None %}
                    <li class="list-group-item list-group-item-secondary">{{ eligibilityRequest.coverage_option_3 }}</li>
                {% elif benefit_3 != None %}
                    <li class="list-group-item  list-group-item-success">{{ eligibilityRequest.coverage_option_3 }} <i class="bi bi-person-check-fill"></i></li>
                {%endif %}
            </ul>
            {% endif %}
        </table>

        <div class="col-md-6 .offset-md-2">
        <h1 class="display-4">Additional plan benefits</h1>
        <ol>
            <li>{{ benefit_1 }}</li>
            <li>{{ benefit_2 }}</li>
            <li>{{ benefit_3 }}</li>
        </ol>
        {% if problemList %}
            <h4>Clinical Data known from the clinical notes <span class="badge bg-warning text-dark">Prior Auth</span></h4>
            <ol>
                {{ listHtml|safe }}
            </ol>
        {% endif %}
         </div>
        <form action="/respond" id="request-approval-form" method="post">
            <input type="hidden" id="requestId" name="requestId" value="{{ eligibilityRequest.id }}">
            <input type="hidden" id="payer_name" name="payer_name" value="{{ payer['Name'] }}">
            <h1 class="display-3">Approve Eligibility Request</h1>
            <div class="row">
            {% if match_approve %}
            <div class="input-group mb-3">
            <span class="input-group-text" id="approve-label">Recommended Action:</span>
            <input class="form-check-input" type="checkbox" id="approved_check" name="approved_check checked>
            <label class="form-check-label" for="approved_check">&nbsp;Approve Request based on automatch</label>
            </div>
            {% else %}
            <div class="input-group mb-3">
            <span class="input-group-text" id="approve-label">Recommended Action:</span>
            <input class="form-check-input" type="checkbox" id="approved_check" name="approved_check>
            <label class="form-check-label" for="approved_check"> &nbsp;Reject request based on failed automatch</label>
            </div>
            {% endif %}
            </div>
           <div class=row">
            <button type="button" class="btn btn-secondary" onClick=onClick="window.location.href='/requests?payerselect='{{coverage.payer.name }}';">Cancel</button>
            <button type="submit" class="btn btn-primary">Submit</button>
            </div>

        </form>


        <form action="/graph" id="labgraphform" method="get">
        <input type="hidden" id="subjectId" name="subjectid" value="{{ patient.SUBJECT_ID }}">
            <input type="hidden" id="coverageId" name="coverageId" value="{{ eligibilityRequest.id }}">
        <div class="mb-3">
            <h3>View Labs for prior-auth <span class="badge bg-warning text-dark">Prior Auth</span></h3>
            <select class="form-select" aria-label="select lab to graph" name="labnamesearch" id="labnamesearch">
                {% for dLabItem in fullLabInfo %}
                    <option value="{{ dLabItem[0] }}">{{ dLabItem[1] }}</option>
               {% endfor %}
           </select>
        </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>

    </div>
</div>

{% endblock %}
